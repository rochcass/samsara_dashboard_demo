
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>

    <script
            src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
            crossorigin="anonymous"></script>
    <script
            src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
            integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
            crossorigin="anonymous"></script>

    <!-- font awesome -->
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- moment.js -->
    <script src="../js/moment.min.js"></script>

    <!-- Local -->
    <link href="../css/bootstrap-ui.css" rel="stylesheet">
    <link href="../css/carma.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/charts.css" rel="stylesheet">
    <script type="text/javascript" src="../js/script.js"></script>
    <script type="text/javascript" src="../js/charts.js"></script>

    <!-- chartjs.org -->
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
</head>
<body>
<div class="chart-legend chart-legend-absolute-bottom-right mt10">
    <div class="legend-list horizontal">
      <span class="legend-element" style="margin-right: 12px;">
        <span class="chart_sentiment_0" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px;"></span>
        <span>Negative</span>
      </span>
        <span class="legend-element" style="margin-right: 12px;">
        <span class="chart_sentiment_1" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px;"></span>
        <span>Neutral</span>
      </span>
        <span class="legend-element" style="margin-right: 12px;">
        <span class="chart_sentiment_2" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px;"></span>
        <span>Positive</span>
      </span>
    </div>
</div>

<div id="horizontal-stacked-bar" style="height: 100%;"></div>

<script>
    var dataset = [{
        data: [{
            name: 'Website',
            count: 123
        }, {
            name: 'Magazine',
            count: 134
        }, {
            name: 'Newspaper',
            count: 245
        }, {
            name: 'Blogs',
            count: 145
        }]
    }, {
        data: [{
            name: 'Website',
            count: 40
        }, {
            name: 'Magazine',
            count: 34
        }, {
            name: 'Newspaper',
            count: 45
        }, {
            name: 'Blogs',
            count: 65
        }]
    },{
        data: [{
            name: 'Website',
            count: 423
        }, {
            name: 'Magazine',
            count: 334
        }, {
            name: 'Newspaper',
            count: 445
        }, {
            name: 'Blogs',
            count: 345
        }]
    }

    ];

    initStackedBarChart('#horizontal-stacked-bar', ['Negative', 'Neutral', 'Positive'], dataset);



    function  initStackedBarChart(element, series, dataset) {

        var margins = {
                top: 8,
                left: 80,
                right: 24,
                bottom: 56,
                barTop: 12
            },
            legendPanel = {
                width: 0
            },
            width = $(element).width() - margins.left - margins.right - legendPanel.width,
            height = $(element).height() - margins.top - margins.bottom,
            dataset = dataset.map(function (d) {
                return d.data.map(function (o, i) {
                    // Structure it so that your numeric
                    // axis (the stacked amount) is y
                    return {
                        y: o.count,
                        x: o.name
                    };
                });
            }),
            stack = d3.layout.stack();
        stack(dataset);

        var dataset = dataset.map(function (group) {
                return group.map(function (d) {
                    // Invert the x and y values, and y0 becomes x0
                    return {
                        x: d.y,
                        y: d.x,
                        x0: d.y0
                    };
                });
            }),
            svg = d3.select(element)
                .append('svg')
                .attr('width', width + margins.left + margins.right + legendPanel.width)
                .attr('height', (height) + margins.top + margins.bottom)
                .append('g')
                .attr('transform', 'translate(' + margins.left + ',' + margins.top + ')'),
            xMax = d3.max(dataset, function (group) {
                return d3.max(group, function (d) {
                    return d.x + d.x0;
                });
            }),
            xScale = d3.scale.linear()
                .domain([0, xMax])
                .range([0, width]),
            names = dataset[0].map(function (d) {
                return d.y;
            }),
            _ = console.log(names),
            yScale = d3.scale.ordinal()
                .domain(names)
                .rangeRoundBands([0, height], .1),
            xAxis = d3.svg.axis()
                .scale(xScale)
                .orient('bottom'),
            yAxis = d3.svg.axis()
                .scale(yScale)
                .orient('left'),
            colours = d3.scale.category10(),
            groups = svg.selectAll('g')
                .data(dataset)
                .enter()
                .append('g')
                .attr('class', function (d, i) {
                    return 'chart_sentiment_' + i;
                }),
            rects = groups.selectAll('rect')
                .data(function (d) {
                    return d;
                })
                .enter()
                .append('rect')
                .attr('class', 'chart_i')
                .attr('x', function (d) {
                    return xScale(d.x0);
                })
                .attr('y', function (d, i) {
                    return yScale(d.y) + margins.barTop;
                })
                .attr('height', function (d) {
                    return yScale.rangeBand();
                })
                .attr('width', function (d) {
                    return xScale(d.x);
                });
             /*   .on('mouseover', function (d) {
                    var xPos = parseFloat(d3.select(this).attr('x')) / 2 + width / 2;
                    var yPos = parseFloat(d3.select(this).attr('y')) + yScale.rangeBand() / 2;

                    d3.select('#tooltip')
                        .style('left', xPos + 'px')
                        .style('top', yPos + 'px')
                        .select('#value')
                        .text(d.x);

                    d3.select('#tooltip').classed('hidden', false);
                })
                .on('mouseout', function () {
                    d3.select('#tooltip').classed('hidden', true);
                });*/

        /* xAxis */
        svg.append('g')
            .attr('class', 'axis')
            .attr('transform', 'translate(0,' + height + ')')
            .call(xAxis);

        /* xAxis */
        svg.append('g')
            .attr('class', 'axis')
            .call(yAxis);


    }
</script>
</body>
</html>