<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bar Chart SVG</title>

    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <link href="../css/charts.css" rel="stylesheet">


    <style>

        .chart text {
            font: 10px sans-serif;
            text-anchor: end;
        }

        .chart .axis path, .chart .axis line { fill: none; stroke: #333; shape-rendering: crispEdges; }


        .d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
        }

        /* Creates a small triangle extender for the tooltip */
        .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
        }

        /* Style northward tooltips differently */
        .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
        }

    </style>
</head>
<body>
<svg class="chart"></svg>
<a onclick="updateLayout(currentData, true)">Toggle Layout</a>


<script type="text/javascript">

    var data = [
        {
            name: 'Bill',
            value: 28
        },
        {
            name: 'Ray',
            value: 10
        },
        {
            name: 'Ford',
            value:22
        },
        {
            name: 'Jake',
            value: 16
        },
        {
            name: 'Steve',
            value: 32
        },
        {
            name: 'Jim',
            value: 45
        }
    ];
    var data2 = [
        {
            name: 'Bill',
            value: 32
        },
        {
            name: 'Ray',
            value: 45
        },
        {
            name: 'Ford',
            value:29
        },
        {
            name: 'Jake',
            value: 24
        },
        {
            name: 'Steve',
            value: 42
        },
        {
            name: 'Jim',
            value: 25
        }
    ];
    var data3 = [
        {
            name: 'Bill',
            value: 12
        },
        {
            name: 'Ray',
            value: 25
        },
        {
            name: 'Ford',
            value:42
        },
        {
            name: 'Jake',
            value: 24
        },
        {
            name: 'Steve',
            value: 42
        },
        {
            name: 'Jim',
            value: 25
        }
    ];

    var horizontal = true,
        margin = {
            top: 20,
            left: 50,
            right: 30,
            bottom: 50
        },
        width = 480,
        height = 400,
        innerWidth = width - margin.left - margin.right,
        innerHeight = height - margin.top - margin.bottom;


    //Add Size to Chart
    var chart = d3.select('.chart')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform','translate('+margin.left+', '+margin.top+')');

    var x, y, xAxis, yAxis;

    var currentData = data;
    var toggle = false;
    updateLayout(data, toggle);
    setTimeout(function () { updateChart(data2); }, 5000);
    setTimeout(function () { updateChart(data3); }, 10000);


    function updateLayout(data, toggle)
    {
        if(toggle)
            horizontal = !horizontal;

        var labels =  d3.scale.ordinal()
            .rangeRoundBands([horizontal ? innerHeight : 0, horizontal ? 0 : innerWidth], 0.1)
            .domain(data.map(function(d){ return d.name; })); // Create Labels

        var series = d3.scale.linear()
            .range([horizontal ? 0 : innerHeight, horizontal ? innerWidth : 0])
            .domain([0, d3.max(data, function(d){ return d.value; })]); // Create Scales

        x = horizontal ? series : labels;

        y = horizontal ? labels : series;

        chart.selectAll('.bar').remove();


        xAxis = d3.svg.axis()
            .scale(x)
            .orient('bottom');

        yAxis = d3.svg.axis()
            .scale(y)
            .orient('left');

        updateChart(currentData);
    }

    function updateChart(data){

        currentData = data;

        chart.selectAll(".y.axis").remove();
        chart.selectAll(".x.axis").remove();

        var xLabel = horizontal ? 'Count' : 'Names';
        chart.append('g')
            .attr('class','x axis')
            .attr('transform', 'translate(0,'+innerHeight+')')
            .call(xAxis)
            .append('text')
            .attr('x', (innerWidth / 2))
            .attr('y', 25)
            .attr('dy', '.71em')
            .style('text-anchor', 'middle')
            .text(xLabel);

        var yLabel = horizontal ? 'Names' : 'Count';
        chart.append('g')
            .attr('class', 'y axis')
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -45)
            .attr("x", -(innerHeight / 2))
            .attr("dy", ".71em")
            .style("text-anchor", "middle")
            .text(yLabel);


        var barSize = horizontal ? y.rangeBand() : x.rangeBand();
        var bars = chart.selectAll('.bar')
            .data(data);

        bars.exit()
            .transition()
            .duration(400)
            .ease("exp")
            .attr(horizontal ? "width" : "height", 0)
            .remove();

        bars
            .enter().append('rect')
            .attr('class', function(d,i){
                return 'bar ' + 'chart_' + (data.length - i - 1);
            })
            .attr('x', function (d) { return horizontal ? 0 : x(d.name); })
            .attr('y', function (d) { return horizontal ? y(d.name) : innerHeight - 1; })

            .attr('width', function (d){
                return horizontal ? 0 : barSize - 1;
            })
            .attr('height', function (d){
                return horizontal ? barSize - 1 : 0;
            })

        bars.transition()
            .duration(750)
            .attr('y', function (d) { return horizontal ? y(d.name) : y(d.value) - 1; })
            .attr(horizontal ? 'width' : 'height', function (d){
                return horizontal ? x(d.value) : innerHeight - y(d.value);
            })
    }


</script>
</body>
</html>