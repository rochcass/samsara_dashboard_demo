<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bar Chart SVG</title>

    <!-- font awesome -->
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <link href="../css/carma.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/charts.css" rel="stylesheet">
    <link href="../css/bootstrap-ui.css" rel="stylesheet">

    <script src="../js/script.js" charset="utf-8"></script>
    <script src="js/bar-v4.js" charset="utf-8"></script>
    <script src="js/donut-v4.js" charset="utf-8"></script>


    <style>

        body { font: 11px sans-serif; }

        .chart text {
            font: 10px sans-serif;
            text-anchor: end;
        }

        .chart .axis path, .chart .axis line { fill: none; stroke: #333; shape-rendering: crispEdges; }


        .tooltip {
            font: 12px sans-serif;
            line-height: 1;
            font-weight: 400;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
            font-family: inherit;
            pointer-events:none; /*let mouse events pass through*/
            opacity:0;
            transition: opacity 0.3s;
            width: auto;
            position: absolute;
        }

        .tooltip:before {
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-right:5px solid rgba(0, 0, 0, 0.8);
            right: 100%;
            content: '';
            top: 10px;
            position: absolute;
            z-index: 99;
        }

        .tooltip-title { display: block; color: orange; }

    </style>
</head>
<body>
<div style="width: 60%; margin: 30px auto;">
<div class="bootstrap-ui ">

    <div class="chart-type-picker inline nmr pull-right">
        <div id="chart_i_type" class="dropdown btn btn-default btn-icon nmr">
            <div><span class="toggle" onclick="$(this).next().toggle();"><span class="label"><span id="chart_i_icon" class="fa fa-bar-chart"></span></span></span>
                <ul class="menu">
                    <li>
                        <a onclick="onChartTypeSelected('bar', this)"><span class="fa fa-bar-chart-o"></span><span>Bar Chart</span></a>
                    </li>
                    <li>
                        <a onclick="onChartTypeSelected('horizontal_bar', this)"><span class="fa fa-bars"></span><span>Horizontal Bar Chart</span></a>
                    </li>
                    <li>
                        <a onclick="onChartTypeSelected('line', this)"><span class="fa fa-line-chart"></span><span>Line Chart</span></a>
                    </li>
                    <li>
                        <a onclick="onChartTypeSelected('area', this)"><span class="fa fa-area-chart"></span><span>Area Chart</span></a>
                    </li>
                    <li>
                        <a onclick="onChartTypeSelected('donut', this)"><span class="fa fa-pie-chart"></span><span>Donut Chart</span></a>
                    </li>
                    <li>
                        <a onclick="onChartTypeSelected('pie', this)"><span class="fa fa-pie-chart"></span><span>Pie Chart</span></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>
    <div>
        <svg id="chart_0" class="chart" width="400" height="400"></svg>
        <div id="tooltip_chart_0" class="tooltip mouse"></div>
    </div>
</div>

</div>
<script type="text/javascript">

    var data = [
        {
            name: 'Bill',
            value: 28
        },
        {
            name: 'Ray',
            value: 10
        },
        {
            name: 'Ford',
            value:22
        },
        {
            name: 'Jake',
            value: 16
        },
        {
            name: 'Steve',
            value: 32
        },
        {
            name: 'Jim',
            value: 45
        }
    ];
    var data2 = [
        {
            name: 'Bill',
            value: 32
        },
        {
            name: 'Ray',
            value: 45
        },
        {
            name: 'Ford',
            value:29
        },
        {
            name: 'Jake',
            value: 24
        },
        {
            name: 'Steve',
            value: 42
        },
        {
            name: 'Jim',
            value: 25
        }
    ];
    var data3 = [
        {
            name: 'Bill',
            value: 12
        },
        {
            name: 'Ray',
            value: 25
        },
        {
            name: 'Ford',
            value:42
        },
        {
            name: 'Jake',
            value: 24
        },
        {
            name: 'Steve',
            value: 42
        },
        {
            name: 'Jim',
            value: 25
        }
    ];

    var currentChartType = 'bar'

    var globalParameters = {
        data: data,
        data2: data2,
        element: '.chart',
        tooltipElement: 'div.tooltip.mouse'
    };

    $(function () {
        setChartDimension();
        loadBar();

        $(window).resize(function(){
          //  setChartDimension();
        });

    });

    function setChartDimension(){
        var chart_cont = $('#chart_0');
        var width = chart_cont.parent().width(),
            height = chart_cont.parent().height();
        chart_cont.attr('width', width);
        chart_cont.attr('height', height);
        chart_cont.attr('viewBox', '0 0 '+ width + ' ' + height);

    }

    function onChartTypeSelected(chart_type, element){
        setChartDimension();

        if(currentChartType !== chart_type) {
            var chart = 'i';
            if (chart_type === 'line') {
                $('#chart_' + chart + '_icon').attr('class', 'fa fa-line-chart');
            }
            else if (chart_type === 'area') {
                $('#chart_' + chart + '_icon').attr('class', 'fa fa-area-chart');
            }
            else if (chart_type === 'bar') {

                $('#chart_' + chart + '_icon').attr('class', 'fa fa-bar-chart-o');

                loadBar();
            }
            else if (chart_type === 'horizontal_bar') {

                var parameters = {
                    horizontal: true,
                    margin: {
                        top: 20,
                        left: 50,
                        right: 20,
                        bottom: 50
                    },
                    width: 480,
                    height: 400,
                    updateLayout: currentChartType === 'bar' ? true : false
            };

                $('#chart_' + chart + '_icon').attr('class', 'fa fa-bars');
                generateBarChart(Object.assign(globalParameters, parameters));
            }
            else if (chart_type === 'area') {
                $('#chart_' + chart + '_icon').attr('class', 'fa fa-area-chart');
            }
            else if (chart_type === 'donut') {

                var parameters = {
                    margin : {
                        top: 80,
                        left: 80,
                        right: 80,
                        bottom: 80
                    },
                    width : 200,
                    height : 200
                };

                $('#chart_' + chart + '_icon').attr('class', 'fa fa-pie-chart');
                generateDonutChart(Object.assign(globalParameters, parameters));
            }

            if(element !== undefined)
                $(element).closest('.menu').toggle();
        }

        currentChartType = chart_type;
    }

    function loadBar(){
        var parameters = {
            horizontal: false,
            margin: {
                top: 20,
                left: 50,
                right: 20,
                bottom: 50
            },
            width: 480,
            height: 400,
            updateLayout: currentChartType === 'horizontal_bar' ? true : false
        };

        generateBarChart(Object.assign(globalParameters, parameters));
    }


</script>
</body>
</html>